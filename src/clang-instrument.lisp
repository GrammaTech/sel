;;; clang-instrument --- Instrument C-language source files
(in-package :se)


;;;; Instrumentation
(defmethod instrument ((obj clang) &key points trace-file)
  (let ((log-var (if trace-file "__bi_mut_log_file" "stderr")))
    (flet ((instrument-ast (original-text trace-strings)
             ;; Given an AST and list of TRACE-STRINGS, return
             ;; instrumented source.
             (format nil "狺狺ア磲疸狎骘蝽狒铋ㄦ矧磲铋㈡瘐趔ㄜ彳茴堍岍箕ア祜绛鲠颟趄徙瀛篝蜷铉螬矧殓轭犰翦舂┅ō季ㄡ篝镡戛蝈盹鲥殒铒徵弭烘蹯飙篝眙换义盹鲥篝狒屙孱趔殒翳妁狎铒舄轭泔眇秕钿篝狒屙孱舢蝈盹鲥殒铒埯篝蜷铉⒚镯痫躅溆繇簪徵弭横篝沆狍簖珏舡疳蝈铘狍镡挲荸磲疸狎徵弭恒秕铘弪箫螋季＇京蝈漉沐灬礅溽鲠蜷犷泔躅翦颟铒翦⑸铙趄蹴孱糸铉劣裕洚泔躅翦颟箦翩ㄧ孱镯鲠蜷犷舂ㄣ灬铉眭翎翦鲠蜷犷啜后弭ê篝眙泔躅翦颟ㄣ镱忽犰蹂ㄩ铙趄蹴孱舡狍疱屐忉钺钺ㄡ珏后蜚翦ㄧ弭狍镡泔躅翦颟┅ㄣ镱ㄦ矧磲铋è好险卧乓洎泔躅翦颟ㄡ珏泔躅翦痫轭趔┅┅┅躔溽翦狍趔鲠蜷犷舂鲠蜷犷舂季洪铋糸犰鲠祯镡戛躔溽翦狍趔箦翩镡戛┅麒孱趄徙瀛骈戾箦翩镡祜绛麸骈戾钺礤镡祜绛鲠趄徙瀛骈戾┅ㄣ灬铉骘蝽狒镡戛镡戛ㄤ彐珏铄蜷珏舡孱趄箫骠麽蝈ê滹沲礤铘狒轱⒁弭躜翳泔躅翦镦翳孱趄劣轭酉圃琢遗┅ㄤ彐礤翳镤珏舡孱趄è镡沆犷绌ㄦ轵篝ㄡ珏后繇舡蜥铉ㄦ轭洵殒埯篝蜷铉㈨衢睥徵弭侯犴妪痱雉雉疱镡戛┅┅ㄤ彐珏铄蜷轭箦螋狒孱趄箫骠麽蝈狍舂ê滹沲礤铘狒轱⑸铙弪劣狒翳孱趄痫轭麸酉圃琢遗┅ㄤ彐礤翳镤轭箦螋狒孱趄è镡沆犷绌ㄡ篝篝蜷铉┅换蜗耘澡盹篝蝻怩篝麽麸疱蜴矧翳轶汜煦蹯狒轱轶麸珧徕换翳麒镬翦骘翳孱趄劣ㄩ瀹㈨衢睥┈犷翳孱麸换轭箦螋翳铄翦牾篝徭翦翳骈蝮Ⅺ戾舄è孱趄ㄧ弭孱趄镡戛镬洵翦疱屐忉钺钺篚怏羼ㄡ珏后蜚翦ㄧ弭狍镡孱趄┅暴┅箦翩ㄧ孱镯镡戛ㄣ灬铉眭翎翦镡啜后弭ê篝眙孱趄ê鲠祯灞ㄣ镱汜翦钺翦篝蜷铉Ⅺ狍镬洵翦舂┅┅镡戛ㄤ彐礤翳镤祜绛麸骈戾钺礤è镡沆犷绌祜绛鲠蜷徕戾骈戾钺礤箦翩镡ㄩ铙弪舡狒孱趄镡ㄦ矧磲铋骘疱瞑蟋堍彳┗ア祜绛鲠蜷徕戾钺礤篝蜷铉骈戾钺礤┅┅换深箦螋翳溴沆狎狒轱狒翳鲥蝙麸镦翳骈戾箦翩ㄧ孱镯镡戛ㄣ镱汜翦钺翦篝蜷铉ㄦ矧磲铋⑵商峄ア祜绛鲠蜷徕戾ㄧ孱镯镡戛┅镡戛换换蔑眄犷扉铄ㄤ彐磲泸珏麸痿é蝈篝骘蝽螬戾è狎ㄧ孱簌愆┅啜祜镳烘矧狎痫狎珞瑚栝戾狎轰ㄣ镱括磲疸狎灬礅溽忾钿è箬矧祜铉怙澌┅啜矧篝蜷铉狎箬矧舂篝蜷铉狎祜铉┅棱镤┅骘蝽螬ê雉桢蝼轶ㄥ蝌矧⒄铗邈镧铋邃狎珲礤铘湖幄狎绌┅┅箦翩铒翦戾鲥飒暴ㄤ彐躅沆犷绛轭篝蝓礤铘ㄡ蜱螬⑸铘弪驷沐麸翳泔眄犷扉铄轭篝蝓礤铘狒轱麸镬ㄩ瞽疳汶徵后濠戾è箦戽痫狎珞┅矧殓轭犰磲脲轭篝犷沐с灬铉恒镯痖戾矧ㄧ弭孱⒚芒沆犷纰烘灬珞ㄧ弭孱⒚铺燎英┅疳翳秕舡溟钺礤豉疱趄徙瀛骈戾秕舡骈戾筢鲥矧殓轭犰麒孱矧铒狎珞戾铉翳狎珞暴篝蜷铉篚怏羼ㄣ狎狎珞博琚篝蜷铉篚怏羼ㄣ狎狎珞畅琚┅ㄦ矧磲⒄筢珏酉找门巯性上斡深篝蝓礤铘酉找门犰镱闲陨衔赢橡糸镱蠛悻泔眇殪弪妹躞妹狍翳泔眇殪弪ㄤ彐狨祠麸妹孱霎鲠蜷徕戾矧沆犷绌片骒徵铺燎泔眄岘箦疳蜥翦扉篝镦泔眇殪弪骒徵ㄤ彐狨祠麸闷塘怯孱霎鲠蜷徕戾铿秕舡骈戾粕膛黩轸眭翎翦箫躜沐麸粕膛ㄤ彐狨祠釉南赵犀矧殓犰箫筢鲥泔瘗镦翳矧殓轭犰瘳聃殄箦鲥蜮矬轸戾鲥麸衄趄徙瀛骈戾粕膛轭篝蝓礤铘邃麸黩轸趄徙麸嫔膛ㄤ彐狨祠麸釉呐乙霈鲥蜮矬握鲥蜮矬轸戾鲥碍迈殪鏖翳鲥蝮轱岙ア箦戽扉箴轫痨屙孱翎糸镱豉疱扉箴轫痨屙孱翎糸镱鲥蝮轱瞟筲屮艉屮轸┅换歪钿狒矧狎珲礤铘螽箦翩疳翳痫狎珞秕舡溟疳翳钺礤溟蝈泗矧疳翳钺礤疳翳钺礤钺礤疳翳豉疱疳翳钺礤豉疱疳翳矧殓轭犰ㄦ蝻憝骈戾矧殓轭犰疳翳┅换橡糸镱螽ㄧ弭镳趔á恽泔眇殪弪箦翩ㄣ镯痖戾矧殓轭犰痫狎珞┅á脾骒徵螈箦翩ㄦ灬珞矧殓轭犰痫狎珞┅á铫秕舡骈戾箦翩秕舡骈戾痫狎珞┅á息矧殓箦翩筢鲥矧殓轭犰舂á瘼聃殄簪箦翩铒翦戾鲥飒癌á簪趄徙瀛骈戾箦翩趄徙瀛骈戾痫狎珞┅á觫鲥蜮矬澧戾è祧疳蝮瀛轭翦珏痫狎珞┅┅麒孱窘祧穿箦翩箬屐飙溴怩绐舂箦翩铒翦戾鲥飒祧飑┅换俞鲥矧殓轭犰麒孱筢鲥矧殓轭犰戾è溴篝磲脲疳翳钺礤轰轵邈麸蝙秕舡溟侯犴ㄦ矧磲铋岘矧殓轭犰钺礤呼疱豉疱┅铒翦⒂狯轭矧殓轭犰麸岙溴篝鏖翳镳孱骈戾秕溴篝轰轵邈糸镱猴豸瘐洪姝屮轶趔后躔弪箦溴ㄧ孱镯瀛篝蜷铉矧殓轭犰秕舂┅换深篝蝓礤铘犷筢鲥铒翦⑸铙趄蹴孱糸铉岙疳翳戾è溴篝矧秕舡骈戾磲脲疳翳钺礤轰轵邈麸蝙秕舡溟侯犴ㄦ矧磲铋岘轭篝蝓礤铘邃钺礤呼疱豉疱┅ㄩ铙趄蹴孱翦ㄣ灬铉骘蝽狒ㄩ铙趄蹴孱矧殓轭犰趄徙瀛骈戾┅┅铒翦⒆蜷糸铉轭篝蝓礤铘邃麸岙溴篝鏖翳镳孱骈戾秕溴篝轰轵邈糸镱猴豸瘐洪姝屮轶趔后躔弪箦溴ㄧ孱镯瀛篝蜷铉轭篝蝓礤铘邃秕舂┅┅