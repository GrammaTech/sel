<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- This file documents the Software Evolution library

Copyright (C) 2014-2018 Eric Schulte and GrammaTech

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3
or any later version published by the Free Software Foundation;
with the Invariant Section being "GNU GENERAL PUBLIC LICENSE,"
A copy of the license is included in the section entitled
"GNU Free Documentation License." -->
<!-- Created by GNU Texinfo 6.7, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Structured Text (Software Evolution Library)</title>

<meta name="description" content="Structured Text (Software Evolution Library)">
<meta name="keywords" content="Structured Text (Software Evolution Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html" rel="start" title="Top">
<link href="Combined-Index.html" rel="index" title="Combined Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Source-Code-with-tree_002dsitter.html" rel="up" title="Source Code with tree-sitter">
<link href="Templates.html" rel="next" title="Templates">
<link href="cl_002dtree_002dsitter-Setup.html" rel="prev" title="cl-tree-sitter Setup">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en">
<span id="Structured-Text"></span><div class="header">
<p>
Next: <a href="Templates.html" accesskey="n" rel="next">Templates</a>, Previous: <a href="cl_002dtree_002dsitter-Setup.html" accesskey="p" rel="prev">cl-tree-sitter Setup</a>, Up: <a href="Source-Code-with-tree_002dsitter.html" accesskey="u" rel="up">Source Code with <code>tree-sitter</code></a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Combined-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Structured-Text-1"></span><h4 class="subsection">2.1.5 Structured Text</h4>
<span id="index-structured_002dtext"></span>

<p>The classes generated for tree-sitter use the rules stored in each language&rsquo;s
grammar file to enable implicit source text reproduction at
the class level. This makes working with and mutating the AST much simpler.
As an example, if an &rsquo;if&rsquo; statement AST without an &rsquo;else&rsquo; clause has an
&rsquo;else&rsquo;clause added to it, the source text of the AST will reflect that an
&rsquo;else&rsquo;clause has been added to it without needing to make any other updates.
(Prior to structured text, slots holding connective white-space and punctuation
required manual updates to accompany most changes to the content of an AST.)
</p>
<p>Each class that is generated can have multiple subclasses which represent
the different representations of source text that the base class can take.
For example, the update expression in C represents both the pre-increment
and post-increment. Two subclasses are generated to disambiguate between the
source text representations&ndash;one for pre-increment and one for
post-increment.
</p>
<p>Frequently, these subclass ASTs can be copied with slight modifications to
their slot values. This can leave the AST copy in an invalid state for the
subclass it had been copied from. When this is detected, the AST&rsquo;s class
will be changed dynamically to the first subclass of the base class which can
successfully produce source text with the given slot values. This behavior
also applies to objects created with the base class, but it may choose a
subclass that&rsquo;s source text is not the desired representation, so it&rsquo;s best
to specify the exact subclass in case where this matters, such as update
expressions in C.
</p>
<p>Structured text ASTs contain at least 4 slots which help store information
that isn&rsquo;t implicit to the AST or its parent <code>ast:</code>
</p>
<ul>
<li> before-text <code>::</code> stores text that directly precedes the AST but is not part
                 of the rule associated with the AST. This is generally
                 whitespace. This slot is preferred over the after-text
                 slot when creating ASTs from a string with <code>#'convert</code>.

</li><li> after-text <code>::</code> stores text that directly procedes the AST but is not part
                of the rule associated with the AST. This is generally
                whitespace. This slot is preferred when a terminal token
                directly follows the AST which does not have a before-text
                slot due to being implicit source text.

</li><li> before-asts <code>::</code> stores comment and error ASTs that occur before the AST
                 and before the contents of the before-text slot. The
                 contents of this slot are considered children of the parent
                 AST. This slot is preferred over the after-text slot when
                 creating ASTs from a string with #&rsquo;convert.

</li><li> after-asts <code>::</code> stores comment and error ASTs that occur before the AST
                and after the contents of the after-text slot. The
                contents of this slot are considered children of the parent
                AST. This slot is preferred when a terminal token
                directly follows the AST which does not have a before-text
                slot due to being implicit source text.

</li><li> internal-asts-|#| <code>::</code> store ASTs which are between two terminal tokens
                       which are implicit source text. This slot can contain
                       comment, error and inner-whitespace ASTs.

</li></ul>
<p>The internal-asts slots are generated based on the rule associated with the
AST. Any possible place in the rule where two terminal tokens can appear
consecutively, an internal-asts slot is placed.
</p>
<p>A further &rsquo;text&rsquo; slot is also used for a subset of ASTs that are known
computed-text ASTs. These ASTs hold information that is variable and must
be computed and stored when the AST is created. The ASTs that are computed
text can be identified by <code>computed-text-node-p</code>.
</p>
<p>When creating ASTs, <code>patch-whitespace</code> can be used to insert whitespace in
relevant places. This utilizes <code>whitespace-between</code> to determine how much
whitespace should be placed in each slot. This currently does not populate
inner-asts whitespace.
</p>
<hr>
<div class="header">
<p>
Next: <a href="Templates.html" accesskey="n" rel="next">Templates</a>, Previous: <a href="cl_002dtree_002dsitter-Setup.html" accesskey="p" rel="prev">cl-tree-sitter Setup</a>, Up: <a href="Source-Code-with-tree_002dsitter.html" accesskey="u" rel="up">Source Code with <code>tree-sitter</code></a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Combined-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
