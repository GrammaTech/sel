<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- This file documents the Software Evolution library

Copyright (C) 2014-2018 Eric Schulte and GrammaTech

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3
or any later version published by the Free Software Foundation;
with the Invariant Section being "GNU GENERAL PUBLIC LICENSE,"
A copy of the license is included in the section entitled
"GNU Free Documentation License." -->
<!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>ASM Super-Mutants (Software Evolution Library)</title>

<meta name="description" content="ASM Super-Mutants (Software Evolution Library)">
<meta name="keywords" content="ASM Super-Mutants (Software Evolution Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Super_002dMutants.html#Super_002dMutants" rel="up" title="Super-Mutants">
<link href="AST-Differencing.html#AST-Differencing" rel="next" title="AST Differencing">
<link href="Clang-Super_002dMutants.html#Clang-Super_002dMutants" rel="prev" title="Clang Super-Mutants">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en">
<a name="ASM-Super_002dMutants"></a>
<div class="header">
<p>
Next: <a href="AST-Differencing.html#AST-Differencing" accesskey="n" rel="next">AST Differencing</a>, Previous: <a href="Clang-Super_002dMutants.html#Clang-Super_002dMutants" accesskey="p" rel="prev">Clang Super-Mutants</a>, Up: <a href="Super_002dMutants.html#Super_002dMutants" accesskey="u" rel="up">Super-Mutants</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html#Index" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<a name="ASM-Super-Mutants"></a>
<h4 class="subsection">3.8.2 ASM Super Mutants</h4>
<a name="index-asm_002dsuper_002dmutants"></a>


<p>asm-super-mutant.lisp <code>---</code> <code>super-mutant</code> for binary files
</p>

<a name="asm_002dsuper_002dmutant-Overview"></a>
<h4 class="subsection">3.8.3 <code>asm-super-mutant</code> Overview</h4>

<p><code>asm-super-mutant</code> software objects are designed to provide the
benefits of <code>super-mutant</code> to binary programs. It&rsquo;s primary
advantage is the ability to evaluate the fitness of large
numbers of variants of the target function, in a single process,
in a minimal amount of time. Avoiding the per-process overhead
in fitness evaluations results in orders-of-magnitude improvements
of efficiency.
</p>
<p>The <code>asm-super-mutant</code> is an <code>asm-heap</code> (models a binary
executable) and also contains <code>super-mutant</code> methods.
</p>
<p>The <code>asm-super-mutant</code> initially contains a complete program
executable (initialized from an asm format file, currently
created from <code>gtx</code> disassembly). In addition it contains a
specification of a target function within the overall executable.
The target function (specified either by name or as start and end
addresses) is used to mark a range of lines within the overall
executable (returned by CREATE-TARGET).
</p>
<p>Like a <code>super-mutant</code>, the <code>asm-super-mutant</code> maintains a collection
of <code>mutants</code>, each one being an instance of the <code>asm-heap</code> software object.
Each <code>mutant</code> is a variant of the target function.
</p>
<a name="Fitness-Evaluation"></a>
<h4 class="subsection">3.8.4 Fitness Evaluation</h4>

<p>To perform fitness evaluation, the <code>asm-supermutant</code> performs the followin
steps:
1) The <code>mutants</code> are combined into a single assembly file (.asm), which
   also includes the data sections and declarations necessary to
   be able to assemble. Every <code>mutant</code> is given a unique label (variant_0,
   (variant_1, ... variant_n), and those labels are exported.
</p>
<p>2) Input/output data, generated by the Intel <code>pin</code> tool, is appended
   to the asm file, and is used to determine fitness of each variant.
   A set of i/o data (memory and register contents) is provided for each
   test run of the target function.
</p>
<p>3) The .asm file is assembled with <code>nasm</code>.
</p>
<p>4) A C harness file (asm-super-mutant-fitness.c), which contains the
   fitness main logic, is compiled and linked to the compiled
   object file. The C code provides functions to set up each test,
   execute each variant, and aggregate results. It contains some
   sandboxing code to handle differences in execution address
   of the original test runs and the fitness runs, manage heap memory
   pages, and trap and handle segment violations and function crashes.
</p>
<p>5) Each variant is assigned an array of fitness results, with each item in
   in the array representing the number of instructions required to execute
   the function. If the variant did not properly pass the tests (i/o data
   did not match) then <code>maxint</code> is assigned as the fitness variable for that
   test (since smaller is better, this basically translates as &quot;unfit&quot;.
</p>
<p>6) The fitness harness writes an array of all results for all variants to
   the <code>*standard-output*</code> stream.
</p>
<p>7) The compiled/linked fitness executable is executed by the fitness test,
   and the results (written to <code>*standard-output*</code> are parsed and stored in
   Lisp data structures (as an array of arrays). This is cached on the
   <code>asm-super-mutant</code> instance, and can be obtained with the <code>fitness</code> method.
</p>
<a name="Tool-Dependencies"></a>
<h4 class="subsection">3.8.5 Tool Dependencies</h4>

<p>The <code>asm-super-mutant</code> currently depends upon:
</p><ul>
<li> Nasm to assemble the generated fitness program
</li><li> Clang (vers. 6 or later) to compile and link the fitness program.
</li><li> A high quality lifter (e.g., GrammaTech&rsquo;s GTx) to disassemble
  the original binary program
</li><li> Python program: collect-io-pairs.py, which invokes Intel <code>pin</code> tools
  to run the original executable with a series of tests.

</li></ul>
<p>The <code>asm-heap</code>, which is the basis for <code>asm-super-mutant</code> and all its
variants, uses Intel-format assembly code (Nasm-compatible).
In the near future we are planning to switch to <code>at&amp;t</code> assembler syntax
and to replace Nasm with a more efficient assembler.
</p>
<a name="Components-2"></a>
<h4 class="subsection">3.8.6 Components</h4>

<p><code>asm-super-mutant</code> software object consists of:
</p>
<ul>
<li> The <code>asm-heap</code>, which is typically based on a file of assembly
  source code.  The <code>asm-super-mutant</code> object contains the whole original
  binary application (in assembler source format).

</li><li> Input/output specifications, in a specific file format as
  generated using the Intel monitoring application and our Python
  scripts

</li><li> Data object original addresses as found when the original binary
  program was tested with <code>pin</code> tools (&quot;sanity file&quot;).

</li><li> Boundary deliminators which determines the target of the
  mutation algorithm

</li></ul>
<p>Note that the struct <code>input-specification</code> is a bit of a misnomer,
as it is used here for both input specification and output
specification (their formats are identical so we use the same
struct for both).
</p>
<p><code>super-mutant</code> slots:
  <code>mutants</code> will contain a list of <code>asm-heap</code> objects.
  <code>super-soft</code> caches a combined <code>asm-heap</code> representing the output fitness
  program.
  <code>phenome-results</code> caches the results obtained from calling the <code>phenome</code>
  method.
</p>
<a name="Current-Limitations"></a>
<h4 class="subsection">3.8.7 Current Limitations</h4>

<ul>
<li> Functions which use floating point data as input or outputs will
  not evaluate correctly. The fitness file that is generated does
  not yet handle <code>ymm0</code>-<code>ymm15</code> registers, which are used to
  pass floating point values in x86_64 binaries.
</li><li> Currently only leaf functions (functions which do not call any other
  functions) are supported.
</li><li> The fitness test program does not do full sandboxing. It does protect
  against segment violations (those will typically result in a
  +worst-fitness+ rating) but a function variant could potentially write
  on other code or data without triggering a segment violation, and this
  will not get trapped. When that happens it will possibly invalidate
  further fitness tests, or cause the whole fitness program to crash,
  resulting in all variants to come back as +worst-fitness+.

</li></ul>


<hr>
<div class="header">
<p>
Next: <a href="AST-Differencing.html#AST-Differencing" accesskey="n" rel="next">AST Differencing</a>, Previous: <a href="Clang-Super_002dMutants.html#Clang-Super_002dMutants" accesskey="p" rel="prev">Clang Super-Mutants</a>, Up: <a href="Super_002dMutants.html#Super_002dMutants" accesskey="u" rel="up">Super-Mutants</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html#Index" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
