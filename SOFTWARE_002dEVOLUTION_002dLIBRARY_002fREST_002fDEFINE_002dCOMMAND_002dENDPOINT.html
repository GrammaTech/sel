<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- This file documents the Software Evolution library

Copyright (C) 2014-2018 Eric Schulte and GrammaTech

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3
or any later version published by the Free Software Foundation;
with the Invariant Section being "GNU GENERAL PUBLIC LICENSE,"
A copy of the license is included in the section entitled
"GNU Free Documentation License." -->
<!-- Created by GNU Texinfo 6.7, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>SOFTWARE-EVOLUTION-LIBRARY/REST/DEFINE-COMMAND-ENDPOINT (Software Evolution Library)</title>

<meta name="description" content="SOFTWARE-EVOLUTION-LIBRARY/REST/DEFINE-COMMAND-ENDPOINT (Software Evolution Library)">
<meta name="keywords" content="SOFTWARE-EVOLUTION-LIBRARY/REST/DEFINE-COMMAND-ENDPOINT (Software Evolution Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html" rel="start" title="Top">
<link href="Combined-Index.html" rel="index" title="Combined Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Software-Evolution-Library-Index.html" rel="up" title="Software Evolution Library Index">
<link href="SOFTWARE_002dEVOLUTION_002dLIBRARY_002fREST_002fSESSIONS.html" rel="next" title="SOFTWARE-EVOLUTION-LIBRARY/REST/SESSIONS">
<link href="SOFTWARE_002dEVOLUTION_002dLIBRARY_002fREST_002fASYNC_002dJOBS.html" rel="prev" title="SOFTWARE-EVOLUTION-LIBRARY/REST/ASYNC-JOBS">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en">
<span id="SOFTWARE_002dEVOLUTION_002dLIBRARY_002fREST_002fDEFINE_002dCOMMAND_002dENDPOINT"></span><div class="header">
<p>
Next: <a href="SOFTWARE_002dEVOLUTION_002dLIBRARY_002fREST_002fSESSIONS.html" accesskey="n" rel="next">SOFTWARE-EVOLUTION-LIBRARY/REST/SESSIONS</a>, Previous: <a href="SOFTWARE_002dEVOLUTION_002dLIBRARY_002fREST_002fASYNC_002dJOBS.html" accesskey="p" rel="prev">SOFTWARE-EVOLUTION-LIBRARY/REST/ASYNC-JOBS</a>, Up: <a href="Software-Evolution-Library-Index.html" accesskey="u" rel="up">Software Evolution Library Index</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Combined-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="SOFTWARE_002dEVOLUTION_002dLIBRARY_002fREST_002fDEFINE_002dCOMMAND_002dENDPOINT-1"></span><h3 class="section">A.19 SOFTWARE-EVOLUTION-LIBRARY/REST/DEFINE-COMMAND-ENDPOINT</h3>
<span id="Macro-sel_002frest_002fdefine_002dcommand_002dendpoint_003adefine_002dendpoint_002droute"></span><dl>
<dt id="index-define_002dendpoint_002droute-_005bsel_002frest_002fdefine_002dcommand_002dendpoint_005d">Macro: <strong>define-endpoint-route [sel/rest/define-command-endpoint]</strong> <em>route-name func required-args &amp;optional command-line-args environment status-fn</em></dt>
<dd><p>Macro to define routes to run the function and retrieve results.
</p>
<p>The &lsquo;define-endpoint-route&lsquo; macro sets up endpoint routes via &lsquo;DEFROUTE&lsquo;
to start asynchronous jobs remotely, mirroring the command definitions from
&lsquo;define-command&lsquo;. The arguments are:
</p>
<ul>
<li> route-name <code>-</code> The name to use for the REST route.
</li><li> func <code>-</code> The function to invoke on given arguments
</li><li> required-args <code>-</code> The named arguments to the function with associated
  types, which will be used to decode the <code>post</code> JSON
  (e.g., &lsquo;((x integer) (y string))&lsquo;).
</li><li> command-line-args (optional) <code>-</code> Additional, optional arguments defined as
  per command-line.lisp.
</li><li> environment (optional) <code>-</code> Variables to let-bind before starting the
  function (such as globals we should dynamically bind). These will be
  initialized to <code>nil</code> before each &lsquo;func&lsquo; task is created.
</li><li> status-fn (optional) <code>-</code> A function to run to retrieve the status of the
  endpoint. It takes the current session and job name as input. If none is
  specified, it defaults to &rsquo;sel/rest/async-jobs::lookup-session-job-status.

</li></ul>
<p>For example, the following invocation of &lsquo;define-endpoint-route&lsquo; will set up an
endpoint that adds five to numbers:
</p>
<table class="cartouche" border="1"><tr><td>
<div class="example">
<pre class="example">    (define-endpoint-route addfive (lambda (value) (+ value 5)) ((value integer)))
</pre></div>
</td></tr></table>

<p>An appropriate REST invocation for this endpoint might look like:
</p>
<table class="cartouche" border="1"><tr><td>
<div class="example">
<pre class="example">    curl -X POST -H &quot;Accept: application/json&quot; 
                 -H &quot;Content-Type: application/json&quot; 
                 http://127.0.0.1:9003/addfive?cid='client-1001' 
                 -d '{&quot;value&quot; : 5}'
</pre></div>
</td></tr></table>

<p>In addition, you can directly name endpoint functions, e.g.<code>:</code>
</p>
<table class="cartouche" border="1"><tr><td>
<div class="example">
<pre class="example">    (define-endpoint-route fact #'alexandria::factorial ((value integer)))
</pre></div>
</td></tr></table>

<p>In this case, the function must be in scope wherever this macro is envoed.
</p></dd></dl>

<hr>
<div class="header">
<p>
Next: <a href="SOFTWARE_002dEVOLUTION_002dLIBRARY_002fREST_002fSESSIONS.html" accesskey="n" rel="next">SOFTWARE-EVOLUTION-LIBRARY/REST/SESSIONS</a>, Previous: <a href="SOFTWARE_002dEVOLUTION_002dLIBRARY_002fREST_002fASYNC_002dJOBS.html" accesskey="p" rel="prev">SOFTWARE-EVOLUTION-LIBRARY/REST/ASYNC-JOBS</a>, Up: <a href="Software-Evolution-Library-Index.html" accesskey="u" rel="up">Software Evolution Library Index</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Combined-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
