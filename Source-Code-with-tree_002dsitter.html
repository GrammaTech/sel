<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- This file documents the Software Evolution library

Copyright (C) 2014-2018 Eric Schulte and GrammaTech

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3
or any later version published by the Free Software Foundation;
with the Invariant Section being "GNU GENERAL PUBLIC LICENSE,"
A copy of the license is included in the section entitled
"GNU Free Documentation License." -->
<!-- Created by GNU Texinfo 6.7, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Source Code with tree-sitter (Software Evolution Library)</title>

<meta name="description" content="Source Code with tree-sitter (Software Evolution Library)">
<meta name="keywords" content="Source Code with tree-sitter (Software Evolution Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html" rel="start" title="Top">
<link href="Combined-Index.html" rel="index" title="Combined Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Software-Objects.html" rel="up" title="Software Objects">
<link href="C_002fC_002b_002b-with-clang.html" rel="next" title="C/C++ with clang">
<link href="Software-Objects.html" rel="prev" title="Software Objects">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en">
<span id="Source-Code-with-tree_002dsitter"></span><div class="header">
<p>
Next: <a href="C_002fC_002b_002b-with-clang.html" accesskey="n" rel="next">C/C++ with <code>clang</code></a>, Previous: <a href="Software-Objects.html" accesskey="p" rel="prev">Software Objects</a>, Up: <a href="Software-Objects.html" accesskey="u" rel="up">Software Objects</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Combined-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>

<span id="Source-Code-with-tree_002dsitter-1"></span><h4 class="subsection">2.1.1 Source Code with <code>tree-sitter</code></h4>


<p>The <a href="SOFTWARE_002dEVOLUTION_002dLIBRARY_002fSOFTWARE_002fTREE_002dSITTER.html#Class-sel_002fsw_002fts_003atree_002dsitter"><code>sel/sw/ts:tree-sitter</code></a> software object class is the primary
base class for representing software source code which has been
parsed into structured abstract syntax trees (ASTs) or more
accurately Concrete Syntax Trees (CSTs).  This class uses GitHub&rsquo;s
tree-sitter (see <a href="https://tree-sitter.github.io/tree-sitter/">https://tree-sitter.github.io/tree-sitter/</a>)
libraries to parse source code into ASTs.
</p>
<p>Tree sitter has support for many source code languages.  See
<a href="https://tree-sitter.github.io/tree-sitter/#available-parsers">Available
Parsers</a> for full list.  <code>sel</code> will define software object classes
for every tree-sitter parser library found on the user&rsquo;s sytem.
Specifically, <code>sel</code> looks in the directories specified by
<a href="SOFTWARE_002dEVOLUTION_002dLIBRARY_002fSOFTWARE_002fTREE_002dSITTER.html#Variable-sel_002fsw_002fts_003a_002atree_002dsitter_002dlanguage_002ddirectories_002a"><code>sel/sw/ts:*tree-sitter-language-directories*</code></a> to find the
<code>grammar.json</code> and <code>node-types.json</code> files that define a
tree-sitter language.  By default these files are expected to be
in <code>/usr/share/tree-sitter/$language/</code>.  The
<a href="SOFTWARE_002dEVOLUTION_002dLIBRARY_002fSOFTWARE_002fTREE_002dSITTER.html#Variable-sel_002fsw_002fts_003a_002atree_002dsitter_002dlanguage_002ddirectories_002a"><code>sel/sw/ts:*tree-sitter-language-directories*</code></a> variable may
be customized to control where <code>sel</code> searches for these files.  For
even more control over the tree-sitter files used the
<a href="SOFTWARE_002dEVOLUTION_002dLIBRARY_002fSOFTWARE_002fTREE_002dSITTER.html#Variable-sel_002fsw_002fts_003a_002atree_002dsitter_002dlanguage_002dfiles_002a"><code>sel/sw/ts:*tree-sitter-language-files*</code></a> variable may be set
directly.  These files are then parsed to automatically define
associated common lisp classes for every type of AST node defined
by the parser.  Currently only the <a href="SOFTWARE_002dEVOLUTION_002dLIBRARY_002fSOFTWARE_002fTREE_002dSITTER.html#Class-sel_002fsw_002fts_003apython"><code>sel/sw/ts:python</code></a> and
<a href="SOFTWARE_002dEVOLUTION_002dLIBRARY_002fSOFTWARE_002fTREE_002dSITTER.html#Class-sel_002fsw_002fts_003ajavascript"><code>sel/sw/ts:javascript</code></a> tree-sitter classes have the full
complement of more sophisticated <a href="SOFTWARE_002dEVOLUTION_002dLIBRARY_002fSOFTWARE_002fPARSEABLE.html#Class-sel_002fsw_002fparseable_003aparseable"><code>sel/sw/parseable:parseable</code></a> methods
(e.g., <a href="SOFTWARE_002dEVOLUTION_002dLIBRARY_002fSOFTWARE_002fPARSEABLE.html#Generic_002dFunction-sel_002fsw_002fparseable_003ascopes"><code>sel/sw/parseable:scopes</code></a>) defined.
</p>
<p>On Arch Linux the
<a href="https://aur.archlinux.org/packages/tree-sitter-languages-git/">tree-sitter-languages-git</a> <code>aur</code> package may be used to install
tree-sitter support for many languages.  On MacOS the following
shell script may be used to achieve similar results:
</p>
<div class="example">
<pre class="example">    #!/bin/bash

    declare -a LANGUAGES
    LANGUAGES=agda bash c c-sharp cpp css go html java javascript jsdoc json julia ocaml/ocaml ocaml/interface php python ql regex ruby rust scala typescript/tsx typescript/typescript

    clone() {
      for language in ${LANGUAGES};do
        LANG=&quot;$(echo ${language}|sed 's|/|-|')&quot;
        git clone https://github.com/tree-sitter/tree-sitter-${LANG} src/tree-sitter-${LANG}
      done
    }

    package() {
      for language in ${LANGUAGES};do
        echo $language
        LANG=&quot;$(echo ${language}|sed 's|/|-|')&quot;
        BASE=&quot;tree-sitter-${LANG}&quot;
        cd src/tree-sitter-${language}/src
        if test -f &quot;scanner.cc&quot;; then
            c++ -fPIC scanner.cc -c -lstdc++
            cc -std=c99 -fPIC parser.c -c
            ar rcs ${BASE}.a scanner.o parser.o
            c++ -dynamiclib -Wl,-install_name,/usr/local/lib/${BASE}.0.dylib scanner.o parser.o -o ${BASE}.0.0.dylib
            ln -sf ${BASE}.0.0.dylib ${BASE}.dylib        
            ln -sf ${BASE}.0.0.dylib ${BASE}.0.dylib
            sudo install -d &quot;/usr/local/lib/tree-sitter/$LANG&quot;
            sudo install -m755 ${BASE}.a &quot;/usr/local/lib/tree-sitter/${BASE}&quot;.a
            sudo install -m755 ${BASE}.0.0.dylib '/usr/local/lib'/${BASE}.0.0.dylib
            ln -sf ${BASE}.0.0.dylib '/usr/local/lib'/${BASE}.0.dylib
            ln -sf ${BASE}.0.0.dylib '/usr/local/lib'/${BASE}.dylib
        elif test -f &quot;scanner.c&quot;; then
            cc -std=c99 -fPIC scanner.c -c
            cc -std=c99 -fPIC parser.c -c
            ar rcs ${BASE}.a scanner.o parser.o
            c++ -dynamiclib -Wl,-install_name,/usr/local/lib/${BASE}.0.dylib scanner.o parser.o -o ${BASE}.0.0.dylib
            ln -sf ${BASE}.0.0.dylib ${BASE}.dylib        
            ln -sf ${BASE}.0.0.dylib ${BASE}.0.dylib
            sudo install -d &quot;/usr/local/lib/tree-sitter/$LANG&quot;
            sudo install -m755 ${BASE}.a &quot;/usr/local/lib/tree-sitter/${BASE}&quot;.a
            sudo install -m755 ${BASE}.0.0.dylib '/usr/local/lib'/${BASE}.0.0.dylib
            ln -sf ${BASE}.0.0.dylib '/usr/local/lib'/${BASE}.0.dylib
            ln -sf ${BASE}.0.0.dylib '/usr/local/lib'/${BASE}.dylib
        else
            cc -std=c99 -fPIC parser.c -c
            ar rcs ${BASE}.a parser.o
            c++ -dynamiclib -Wl,-install_name,/usr/local/lib/${BASE}.0.dylib parser.o -o ${BASE}.0.0.dylib
            ln -sf ${BASE}.0.0.dylib ${BASE}.dylib        
            ln -sf ${BASE}.0.0.dylib ${BASE}.0.dylib
            sudo install -d &quot;/usr/local/lib/tree-sitter/$LANG&quot;
            sudo install -m755 ${BASE}.a &quot;/usr/local/lib/tree-sitter/${BASE}&quot;.a
            sudo install -m755 ${BASE}.0.0.dylib '/usr/local/lib'/${BASE}.0.0.dylib
            ln -sf ${BASE}.0.0.dylib '/usr/local/lib'/${BASE}.0.dylib
            ln -sf ${BASE}.0.0.dylib '/usr/local/lib'/${BASE}.dylib
        fi
        sudo install -d /usr/local/share/tree-sitter/${language}/
        sudo install -m644 grammar.json node-types.json /usr/local/share/tree-sitter/${language}/
        cd - &gt;/dev/null
      done

    }

    mkdir -p src/
    clone
    package
</pre></div>


<hr>
<div class="header">
<p>
Next: <a href="C_002fC_002b_002b-with-clang.html" accesskey="n" rel="next">C/C++ with <code>clang</code></a>, Previous: <a href="Software-Objects.html" accesskey="p" rel="prev">Software Objects</a>, Up: <a href="Software-Objects.html" accesskey="u" rel="up">Software Objects</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Combined-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
